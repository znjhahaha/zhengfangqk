# TYUST选课工具 - Next.js全栈应用 🎓

专为多学校设计的现代化选课工具，采用Next.js全栈架构，提供美观易用的Web界面，支持多用户同时使用，数据完全隔离。

## ✨ 功能特点

### 🎯 核心功能
- **🎓 学生信息管理** - 查看和刷新学生基本信息
- **📚 课程信息浏览** - 查看可选课程和已选课程，支持搜索和筛选
- **🎯 智能选课系统** - 多种选课模式，自动抢课
- **📅 课表查询** - 查看个人课程表，支持导出
- **📊 成绩查询** - 查询学期成绩和总体成绩
- **⚙️ 系统配置管理** - Cookie配置和个性化设置
- **🏫 多学校支持** - 支持多个学校配置，可在后台添加新学校
- **📢 公告系统** - 管理员可发布公告，用户可查看和确认
- **💬 建议反馈** - 用户可提交建议和反馈，管理员可查看

### 🚀 技术特色
- **Next.js全栈** - 前后端一体化，无需额外后端服务
- **多用户支持** - 完全的用户数据隔离，支持多用户同时使用
- **数据持久化** - 所有数据（学校、公告、建议）永久保存到文件系统
- **本地存储** - 用户数据存储在浏览器本地（localStorage），确保隐私
- **服务器无状态** - 服务器端不存储用户状态，所有状态在客户端
- **现代化UI** - 基于Next.js 14 + Tailwind CSS
- **响应式设计** - 支持各种屏幕尺寸
- **动画效果** - 流畅的页面切换和交互动画
- **实时状态** - 选课进度实时显示
- **智能重试** - 自动重试机制，提高成功率

### 🎨 界面亮点
- **深色主题** - 护眼的深色界面设计
- **玻璃效果** - 现代化的毛玻璃卡片设计
- **渐变背景** - 美观的渐变背景
- **图标系统** - 统一的Lucide图标
- **状态指示** - 清晰的状态和进度指示
- **动画过渡** - 流畅的页面切换和组件动画

## 🛠️ 技术栈

### 前端
- **Next.js 14** - React全栈框架
- **TypeScript** - 类型安全的JavaScript
- **Tailwind CSS** - 实用优先的CSS框架
- **Framer Motion** - 动画库
- **Radix UI** - 无障碍UI组件
- **Lucide React** - 图标库
- **React Hot Toast** - 通知提示

### 后端（Next.js API Routes）
- **Next.js API Routes** - 内置API路由
- **Node.js fs/promises** - 文件系统操作（数据持久化）
- **Cheerio** - 服务器端HTML解析
- **TypeScript** - 类型安全的JavaScript

## 🚀 快速开始

### 环境要求
- Node.js 18+ 
- 现代浏览器

### 一键启动
```bash
# Windows用户
start-nextjs.bat

# 或手动启动
cd nextjs-course-selector
npm install
npm run dev
```

### 访问地址
- **应用界面**: http://localhost:3000
- **API接口**: http://localhost:3000/api/health

### 生产环境部署
```bash
npm run build
npm start
```

## 📖 使用指南

### 1. 配置Cookie
1. 在浏览器中登录教务系统
2. 打开开发者工具 (F12)
3. 复制Cookie值
4. 在"系统设置"页面粘贴Cookie
5. Cookie会保存在浏览器本地，确保隐私安全

### 2. 选择学校
1. 在"学校选择"页面选择您的学校
2. 学校配置保存在本地，不同用户互不影响
3. 管理员可在后台添加新学校

### 3. 查看学生信息
- 在"学生信息"页面点击"刷新信息"
- 查看个人信息完整度
- 支持导出学生信息

### 4. 浏览课程
- 在"课程信息"页面查看可选课程
- 支持搜索和筛选
- 点击"抢课"按钮快速选课
- 支持批量选课

### 5. 查看课表
- 在"我的课表"页面查看课程安排
- 支持网格视图和列表视图
- 课表数据保存在本地，切换学校时自动隔离
- 支持导出课表

### 6. 查询成绩
- 在"成绩查询"页面选择学年和学期
- 查看详细成绩信息
- 查看总体成绩和GPA

### 7. 智能选课
- 选择选课模式：
  - **捡漏模式**: 重复请求所有可选网课
  - **网课优先**: 优先选择D类网课
  - **关键词匹配**: 根据关键词筛选课程
- 配置选课参数
- 启动智能选课系统

### 8. 查看公告
- 系统会自动显示未查看的公告
- 点击"查看公告"按钮查看历史公告
- 可确认收到公告，管理员可查看确认人数

### 9. 提交建议
- 点击"建议反馈"按钮
- 选择建议类型（学校、BUG、功能、其他）
- 填写标题和内容
- 管理员可在后台查看和处理建议

## 🔐 多用户支持

### 数据隔离机制
- **学校选择** - 每个用户独立选择学校，存储在本地localStorage
- **Cookie配置** - 每个用户的Cookie独立存储
- **课表数据** - 按学校ID隔离存储，不同用户互不影响
- **所有用户数据** - 完全存储在客户端，服务器不保存用户状态

### 服务器端设计
- **无状态架构** - 服务器端不存储任何用户状态
- **参数传递** - 所有请求通过参数传递schoolId等标识
- **数据持久化** - 仅管理员数据（学校列表、公告、建议）保存到文件系统

## 📁 数据存储

### 客户端存储（localStorage）
- `selected-school-id` - 当前选择的学校ID
- `course-cookie` - 用户Cookie（加密存储）
- `schedule-{schoolId}` - 课表数据（按学校隔离）
- `course-selection-logs` - 选课日志
- `viewed-announcements` - 已查看的公告ID列表

### 服务器端存储（文件系统）
所有管理员数据保存在 `data/` 目录下：
- `data/schools.json` - 学校列表配置
- `data/url-configs.json` - URL配置
- `data/announcements.json` - 公告列表
- `data/suggestions.json` - 用户建议
- `data/announcement-confirmations.json` - 公告确认记录

**注意**: 数据目录会被Git忽略，确保不提交敏感数据。

## 🎯 选课模式详解

### 捡漏模式
- 适用于：想要捡漏退课名额的学生
- 特点：重复请求所有可选网课
- 优势：覆盖面广，机会多

### 网课优先
- 适用于：时间灵活，偏好网课的学生
- 特点：优先选择D类网课
- 优势：时间自由，学习灵活

### 关键词匹配
- 适用于：有特定课程偏好的学生
- 特点：根据课程名、教师名匹配
- 优势：精准定位目标课程

## 🔧 配置说明

### 选课参数
- **最大尝试次数**: 1-1000次，建议100次
- **请求间隔**: 0.1-10秒，建议1秒
- **超时时间**: 30秒

### 系统设置
- **主题模式**: 深色/浅色主题
- **动画效果**: 页面切换动画
- **响应式布局**: 自适应屏幕

### 管理员配置
- **管理员密码**: 通过环境变量 `ADMIN_SECRET_TOKEN` 设置（默认：`Znj00751_admin_2024`）
- **数据目录**: 默认使用 `data/`，如果不可写则使用 `/tmp/qiangke-data`

## 📊 后台管理

### 功能说明
- **学校管理** - 添加、编辑、删除学校配置
- **公告管理** - 发布、编辑、删除公告，查看确认人数
- **建议管理** - 查看用户建议，审核和处理
- **数据管理** - 查看数据统计和日志

### 访问方式
1. 点击页面右上角"管理"按钮
2. 输入管理员密码登录
3. 进入后台管理页面

## 🛡️ 安全说明

- **数据隐私** - Cookie信息仅存储在用户浏览器本地
- **数据隔离** - 多用户数据完全隔离，互不影响
- **服务器无状态** - 服务器不存储用户状态，确保安全
- **数据持久化** - 管理员数据永久保存，服务器重启不丢失
- **支持HTTPS** - 生产环境建议使用HTTPS连接
- **遵循规范** - 请遵守学校相关规定

## 🐛 故障排除

### 常见问题

**Q: 无法连接到后端服务器**
A: 检查Node.js环境，确保服务正常运行，访问 `/api/health` 检查状态

**Q: 选课失败**
A: 检查Cookie是否有效，网络连接是否正常，学校配置是否正确

**Q: 界面显示异常**
A: 清除浏览器缓存，刷新页面，检查浏览器控制台错误信息

**Q: 数据丢失（学校、公告消失）**
A: 
- 检查 `data/` 目录权限，确保可写
- 检查服务器日志，查看文件保存错误
- 如果是云环境，确保使用持久化存储或配置正确的数据目录

**Q: 多用户数据混乱**
A: 
- 确保使用的是最新版本
- 清除浏览器缓存和localStorage
- 检查是否每个用户使用不同的浏览器/账号

**Q: 依赖安装失败**
A: 检查Node.js版本（需要18+），使用管理员权限运行，清除npm缓存

### 日志查看
- **浏览器控制台** (F12) - 查看前端错误和请求日志
- **服务器终端** - 查看后端API错误和文件操作日志
- **网络请求面板** - 查看API请求和响应

### 调试模式
- 浏览器控制台会输出详细的调试信息
- 服务器日志包含数据加载和保存的详细信息
- 使用 `/api/health` 检查服务器状态

## 📝 更新日志

### v2.0.0 (2024-XX-XX)
- ✨ **多用户支持** - 完全的用户数据隔离，支持多用户同时使用
- ✨ **数据持久化** - 学校、公告、建议等数据永久保存到文件系统
- ✨ **公告系统** - 管理员可发布公告，用户可查看和确认
- ✨ **建议系统** - 用户可提交建议和反馈
- ✨ **后台管理** - 完整的后台管理系统
- 🔧 **服务器无状态** - 服务器端不存储用户状态
- 🔧 **本地存储** - 用户数据存储在浏览器本地
- 🐛 **修复BUG** - 修复数据丢失问题

### v1.0.0 (2024-01-XX)
- ✨ 初始版本发布
- 🎨 现代化UI界面
- 🚀 智能选课系统
- 📱 响应式设计
- 🎯 多种选课模式

## 🗂️ 项目结构

```
nextjs-course-selector/
├── app/                    # Next.js App Router
│   ├── api/               # API路由
│   │   ├── admin/         # 后台管理API
│   │   ├── course-selection/  # 选课API
│   │   └── ...
│   └── page.tsx           # 主页面
├── components/            # React组件
│   ├── pages/            # 页面组件
│   └── ui/               # UI组件
├── lib/                   # 工具函数和库
│   ├── course-api.ts     # 课程API
│   ├── global-school-state.ts  # 学校状态管理
│   └── ...
├── data/                  # 数据存储目录（Git忽略）
│   ├── schools.json      # 学校配置
│   ├── announcements.json # 公告数据
│   └── ...
└── README.md             # 项目说明
```

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境
```bash
git clone <repository>
cd nextjs-course-selector
npm install
npm run dev
```

### 代码规范
- 使用TypeScript
- 遵循ESLint规则
- 组件化开发
- 注释完整
- 确保多用户数据隔离

### 提交规范
- 修复BUG: `fix: 描述`
- 新功能: `feat: 描述`
- 文档更新: `docs: 描述`
- 代码优化: `refactor: 描述`

## 📄 许可证

本项目仅供学习交流使用，请遵守学校相关规定。

## 🙏 致谢

感谢所有贡献者和用户的支持！

---

**⚠️ 免责声明**: 本工具仅供学习交流使用，使用者需自行承担使用风险，请遵守学校相关规定。数据存储在本地，请妥善保管您的Cookie和配置信息。
